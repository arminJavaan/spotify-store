<!DOCTYPE html>
<html lang="fa" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>سفارش‌های من - SpotifyStore</title>

  <!-- فونت وزیر -->
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/font-face.css" rel="stylesheet" />

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#1db954',
            dark1: '#212121',
            dark2: '#121212',
            gray1: '#535353',
            gray2: '#b3b3b3'
          },
          fontFamily: {
            vazir: ['Vazir', 'sans-serif']
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' }
            },
            slideIn: {
              '0%': { transform: 'translateY(30px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' }
            }
          },
          animation: {
            fadeIn: 'fadeIn 0.6s ease-in-out',
            slideIn: 'slideIn 0.6s ease-in-out'
          }
        }
      }
    }
  </script>

  <style>
    html { scroll-behavior: smooth; }
    body { font-family: 'Vazir', sans-serif; background-color: #121212; color: #b3b3b3; }
  </style>
</head>
<body class="min-h-screen flex flex-col">

  <!-- هدر مشترک -->
  <header class="bg-[#212121]">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
      <div class="text-2xl font-bold text-primary">SpotifyStore</div>
      <nav class="space-x-6">
        <a href="index.html" class="text-gray-2 hover:text-primary transition">خانه</a>
        <a href="products.html" class="text-gray-2 hover:text-primary transition">محصولات</a>
        <a href="login.html" class="text-gray-2 hover:text-primary transition">ورود / ثبت‌نام</a>
        <a href="cart.html" class="relative text-gray-2 hover:text-primary transition">
          <span id="cartIcon">🛒</span>
          <span id="cartCount" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
        </a>
      </nav>
    </div>
  </header>

  <!-- بخش سفارش‌های من -->
  <main class="container mx-auto px-4 py-12">
    <h2 class="text-3xl font-bold text-primary mb-8 text-center animate-fadeIn">سفارش‌های من</h2>
    <div id="ordersContainer" class="space-y-6">
      <!-- JS لیست سفارشات را واکشی و رندر می‌کند -->
    </div>
  </main>

  <!-- فوتر -->
  <footer class="bg-[#212121] py-4 mt-auto">
    <div class="container mx-auto px-4 text-center text-gray-2">
      © ۱۴۰۲ SpotifyStore. تمامی حقوق محفوظ است.
    </div>
  </footer>

  <script>
    // تابع واکشی و نمایش سفارش‌ها
    async function loadOrdersPage() {
      const token = localStorage.getItem('token');
      if (!token) {
        window.location.href = 'login.html';
        return;
      }
      try {
        const res = await fetch('http://localhost:5000/api/orders', {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.msg || 'خطا در واکشی سفارش');
        const ordersContainer = document.getElementById('ordersContainer');
        if (!data.length) {
          ordersContainer.innerHTML = `
            <p class="text-center text-gray-2">شما هنوز سفارشی ثبت نکرده‌اید.</p>
          `;
          return;
        }
        ordersContainer.innerHTML = data.map(order => `
          <div class="bg-[#212121] p-4 rounded-lg shadow-lg animate-slideIn">
            <h3 class="text-lg font-semibold text-primary mb-2">سفارش #${order._id.slice(-6)}</h3>
            <p class="text-gray-2 mb-1">مبلغ کل: ${Number(order.totalAmount).toLocaleString('fa-IR')} تومان</p>
            <p class="text-gray-2 mb-1">روش پرداخت: ${order.paymentMethod}</p>
            <p class="text-gray-2 mb-2">وضعیت: ${order.status}</p>
            ${order.paymentMethod === 'whatsapp' && order.whatsappOrderUrl ? `
              <a href="${order.whatsappOrderUrl}" target="_blank" class="inline-block px-3 py-1 bg-green-600 text-[#121212] rounded hover:bg-green-700 transition">مشاهده واتساپ</a>
            ` : ''}
          </div>
        `).join('');
      } catch (err) {
        console.error(err);
        alert('خطا: ' + err.message);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadOrdersPage();
    });
  </script>
</body>
</html>
